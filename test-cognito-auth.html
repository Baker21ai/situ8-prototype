<!DOCTYPE html>
<html>
<head>
    <title>Cognito JWT Token Generator</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .token-display { background: #f8f9fa; padding: 10px; border: 1px solid #ddd; border-radius: 3px; font-family: monospace; word-break: break-all; margin: 5px 0; }
        button { padding: 8px 15px; margin: 5px; }
        input { padding: 5px; width: 300px; margin: 5px; }
    </style>
</head>
<body>
    <h1>üîê Cognito Authentication Test</h1>
    
    <div>
        <h3>Generate JWT Token</h3>
        <input type="email" id="emailInput" placeholder="Email" value="yamen@example.com" />
        <input type="password" id="passwordInput" placeholder="Password" value="TempPassword123!" />
        <button onclick="authenticate()">Login & Get Token</button>
        <button onclick="testToken()">Test Token Format</button>
    </div>
    
    <div>
        <h3>Token Output:</h3>
        <div id="tokenDisplay" class="token-display">No token generated yet</div>
    </div>
    
    <div>
        <h3>Token Payload:</h3>
        <div id="payloadDisplay" class="token-display">No payload decoded yet</div>
    </div>

    <script src="https://unpkg.com/amazon-cognito-identity-js@latest/dist/amazon-cognito-identity.min.js"></script>
    <script>
        let cognitoToken = null;
        
        // Cognito configuration
        const REGION = 'us-west-2';
        const USER_POOL_ID = 'us-west-2_ECLKvbdSp';
        const CLIENT_ID = '5ouh548bibh1rrp11neqcvvqf6';
        
        // Initialize Cognito User Pool
        const poolData = {
            UserPoolId: USER_POOL_ID,
            ClientId: CLIENT_ID
        };
        const userPool = new AmazonCognitoIdentity.CognitoUserPool(poolData);
        
        function authenticate() {
            const email = document.getElementById('emailInput').value;
            const password = document.getElementById('passwordInput').value;
            
            if (!email || !password) {
                alert('Please enter both email and password');
                return;
            }
            
            console.log('üîê Attempting to authenticate with Cognito...');
            
            const userData = {
                Username: email,
                Pool: userPool
            };
            
            const cognitoUser = new AmazonCognitoIdentity.CognitoUser(userData);
            
            const authenticationDetails = new AmazonCognitoIdentity.AuthenticationDetails({
                Username: email,
                Password: password
            });
            
            cognitoUser.authenticateUser(authenticationDetails, {
                onSuccess: function(result) {
                    cognitoToken = result.getIdToken().getJwtToken();
                    console.log('‚úÖ Authentication successful!');
                    console.log('üé´ JWT Token:', cognitoToken);
                    
                    document.getElementById('tokenDisplay').textContent = cognitoToken;
                    
                    // Decode and display payload
                    try {
                        const payload = JSON.parse(atob(cognitoToken.split('.')[1]));
                        document.getElementById('payloadDisplay').textContent = JSON.stringify(payload, null, 2);
                    } catch (e) {
                        document.getElementById('payloadDisplay').textContent = 'Error decoding payload: ' + e.message;
                    }
                },
                onFailure: function(err) {
                    console.error('‚ùå Authentication failed:', err);
                    document.getElementById('tokenDisplay').textContent = 'Authentication failed: ' + err.message;
                    document.getElementById('payloadDisplay').textContent = 'No payload - authentication failed';
                }
            });
        }
        
        function testToken() {
            if (!cognitoToken) {
                alert('Please authenticate first to get a token');
                return;
            }
            
            // Test WebSocket URL with token
            const WS_URL = 'wss://8hj9sdifek.execute-api.us-west-2.amazonaws.com/dev';
            const wsUrlWithToken = WS_URL + '?token=' + encodeURIComponent(cognitoToken);
            
            console.log('üîó WebSocket URL with token:', wsUrlWithToken);
            console.log('üìã Token length:', cognitoToken.length);
            console.log('üéØ Testing WebSocket connection...');
            
            const ws = new WebSocket(wsUrlWithToken);
            
            ws.onopen = function(event) {
                console.log('‚úÖ WebSocket connected successfully!');
                alert('‚úÖ WebSocket connected successfully!');
                ws.close();
            };
            
            ws.onclose = function(event) {
                console.log('‚ùå WebSocket closed:', event.code, event.reason);
                alert('‚ùå WebSocket closed: Code ' + event.code + ', Reason: ' + (event.reason || 'No reason'));
            };
            
            ws.onerror = function(error) {
                console.error('üí• WebSocket error:', error);
                alert('üí• WebSocket error occurred');
            };
        }
    </script>
</body>
</html>