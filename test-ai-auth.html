<!DOCTYPE html>
<html>
<head>
    <title>AI Authentication Test</title>
</head>
<body>
    <h1>AI Authentication Test</h1>
    <div id="results"></div>
    
    <script>
        // Test function to check AI authentication
        async function testAIAuth() {
            const results = document.getElementById('results');
            
            try {
                // Check if we have access to the global services
                const services = window.__SITU8_SERVICES__;
                const apiClient = services?.apiClient;
                const authToken = apiClient?.getAuthToken();
                
                results.innerHTML += `<p><strong>API Client Available:</strong> ${!!apiClient}</p>`;
                results.innerHTML += `<p><strong>Auth Token Available:</strong> ${!!authToken}</p>`;
                
                if (authToken) {
                    results.innerHTML += `<p><strong>Token Preview:</strong> ${authToken.substring(0, 50)}...</p>`;
                    
                    // Test AI chat endpoint
                    results.innerHTML += `<p>Testing AI chat endpoint...</p>`;
                    
                    const testMessage = {
                        messages: [{ role: 'user', content: 'Hello, this is a test message' }],
                        modelId: 'anthropic.claude-3-5-sonnet-20241022-v2:0',
                        temperature: 0.3,
                        maxTokens: 800
                    };
                    
                    const response = await fetch('https://z4hhgkzhq7.execute-api.us-west-2.amazonaws.com/dev/api/ai/chat', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${authToken}`
                        },
                        body: JSON.stringify(testMessage)
                    });
                    
                    results.innerHTML += `<p><strong>Response Status:</strong> ${response.status}</p>`;
                    
                    const responseData = await response.text();
                    results.innerHTML += `<p><strong>Response:</strong> ${responseData}</p>`;
                    
                } else {
                    results.innerHTML += `<p style="color: red;"><strong>No authentication token found!</strong></p>`;
                    results.innerHTML += `<p>Please log in first to test AI functionality.</p>`;
                }
                
            } catch (error) {
                results.innerHTML += `<p style="color: red;"><strong>Error:</strong> ${error.message}</p>`;
            }
        }
        
        // Run test when page loads
        window.addEventListener('load', () => {
            // Wait a bit for the app to initialize
            setTimeout(testAIAuth, 2000);
        });
    </script>
</body>
</html>